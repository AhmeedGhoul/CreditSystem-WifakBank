// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  userId           Int         @id @default(autoincrement())
  firstName        String      @db.VarChar(100)
  lastName         String      @db.VarChar(100)
  email            String      @unique @db.VarChar(255)
  password         String      @db.VarChar(255)
  age              Int         @default(18)
  adress           String      @db.Text
  phoneNumber      Int
  userScore        Float       @default(0)
  roles            Role[]      @relation("UserRoles")
  civilStatus      CivilStatus
  dateOfBirth      DateTime
  isEnabled        Boolean     @default(true)
  isAccountBlocked Boolean     @default(false)
  createdDate      DateTime    @default(now())
  lastModifiedDate DateTime    @updatedAt

  ActivityLogs ActivityLog[]
  Contracts    Contracts[]
  Requests     Request[]
  Garents      Garent[]
  accounts     Account[]
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users User[] @relation("UserRoles")
}

model Audit {
  auditId     Int         @id @default(autoincrement())
  auditStatus AuditStatus
  auditOutput String      @db.Text
  auditDate   DateTime    @default(now())
  auditType   AuditType

  activityLog   ActivityLog @relation(fields: [activityLogId], references: [activityLogId])
  activityLogId Int         @unique

  Fraud_Case Fraud_Case[]
}

model ActivityLog {
  activityLogId          Int      @id @default(autoincrement())
  activityLogName        String   @db.VarChar(255)
  activityLogDescription String   @db.Text
  activityDate           DateTime @default(now())
  ipAddress              String   @db.VarChar(45)
  country                String   @db.VarChar(100)

  User       User? @relation(fields: [userUserId], references: [userId])
  userUserId Int?

  Audit Audit?
}

model Fraud_Case {
  fraudCaseId   Int           @id @default(autoincrement())
  fraudCaseType FraudCaseType
  detectionDate DateTime      @default(now())
  caseStatus    CaseStatus

  audit   Audit? @relation(fields: [auditId], references: [auditId])
  auditId Int?
}

model Document {
  documentId   Int      @id @default(autoincrement())
  documentDate DateTime
  isApproved   Boolean  @default(false)
  requestId    Int?
  Request      Request? @relation(fields: [requestId], references: [requestId])
}

model Request {
  requestId         Int        @id @default(autoincrement())
  requestDate       DateTime   @default(now())
  isRequestApproved Boolean    @default(false)
  User              User?      @relation(fields: [userUserId], references: [userId])
  userUserId        Int?
  Documents         Document[]
}

model Credit_Pool_Payment {
  creditPoolPaymentId Int        @id @default(autoincrement())
  date                String     @db.VarChar(50)
  amount              String     @db.VarChar(50)
  contract            Contracts? @relation(fields: [contractId], references: [contractId])
  contractId          Int?
}

model Contracts {
  contractId   Int      @id @default(autoincrement())
  contractDate DateTime @default(now())
  amount       Float
  deposit      Float

  User       User? @relation(fields: [userUserId], references: [userId])
  userUserId Int?

  credit_Pool_Payment Credit_Pool_Payment[]
  credit_Pool         Credit_Pool?          @relation(fields: [creditPoolId], references: [creditPoolId])
  creditPoolId        Int?
}

model Credit_Pool {
  creditPoolId   Int         @id @default(autoincrement())
  minValue       Float
  maxValue       Float
  isFull         Boolean     @default(false)
  numberOfPeople Int         @default(0)
  openDate       DateTime
  closeDate      DateTime
  contracts      Contracts[]
}

model Garent {
  garentId    Int    @id @default(autoincrement())
  firstName   String @db.VarChar(100)
  lastName    String @db.VarChar(100)
  phoneNumber Int
  User        User?  @relation(fields: [userUserId], references: [userId])
  userUserId  Int?
}

model Account {
  accountId      Int               @id @default(autoincrement())
  openDate       DateTime          @default(now())
  amount         Float             @default(0)
  trackingNumber Int               @unique
  linkedUserId   Int
  user           User              @relation(fields: [linkedUserId], references: [userId])
  payments       Account_Payment[]
}

model Account_Payment {
  paymentId Int      @id @default(autoincrement())
  date      DateTime @default(now())
  method    String   @db.VarChar(50)
  amount    Float
  account   Account  @relation(fields: [accountId], references: [accountId])
  accountId Int
}

enum UserRole {
  Admin
  Client
  Agent
  Auditor
}

enum AuditStatus {
  PENDING
  Paused
  APPROVED
  REJECTED
}

enum CivilStatus {
  Married
  Divorced
  Single
  Widow
}

enum FraudCaseType {
  IDENTITY_THEFT
  ACCOUNT_TAKEOVER
  FAKE_DOCUMENT
}

enum AuditType {
  Finacial
  compliance
  Risk
}

enum CaseStatus {
  OPEN
  CLOSED
  UNDER_INVESTIGATION
}
